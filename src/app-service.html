<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<dom-module id="app-service">

  <template>
<!-- To fetch menu items for drawer-->
 <iron-ajax
   	      id="menuajax"
   	      url="{{url}}"
   	      handle-as="json"
   	      content-type="application/json"
          on-response="menuResponse">
 </iron-ajax>
 <!-- To fetch category items like grocery,vegitables in home page-->
 <iron-ajax

 	      id="categoryajax"
 	      auto
 	      url="http://zencouch-zencodoo.rhcloud.com/grocery/0231faf356f6525d71f94a8fad0035f5"
 	      body=""
 	      handle-as="json"
 	      content-type="application/json"
           on-response="categoryResponse"
          debounce-duration="300"></iron-ajax>
 <!-- To fetch items under each category type like rice,flours..etc under groceries-->
 <iron-ajax

		  	      id="itemcategoryajax"
		  	      url="{{name}}"
		  	      body=""
		  	      handle-as="json"
		  	      content-type="application/json"
		          on-response="itemcategoryResponse"

          debounce-duration="300"></iron-ajax>
 <!--To fetch all items under each category type like rice,flours..etc -->
 <iron-ajax
		     	      id="itemlistajax"
		     	      url="{{url}}"
		     	      handle-as="json"
		     	      content-type="application/json"
		            on-response="itemlistResponse"
		            debounce-duration="300"></iron-ajax>
<!--To fetch offer items under each category type like rice,flours..etc -->
 <iron-ajax
					   	      id="offeritemlistajax"
					   	      url="{{url}}"
					   	      handle-as="json"
					   	      content-type="application/json"
					          on-response="offeritemlistResponse"
					          debounce-duration="300"></iron-ajax>
  <!-- To fetch brand items under brand-->
  <iron-ajax
    	      id="brandlistajax"
    	      url="{{url}}"
    	      handle-as="json"
    	      content-type="application/json"
           on-response="brandlistResponse"
           debounce-duration="300">
 </iron-ajax>
 <iron-ajax
     	      id="addtocartajax"
     	      url="{{url}}"
     	      handle-as="json"
     	      content-type="application/json"
            on-response="addtocartResponse"
            debounce-duration="300">
 </iron-ajax>


<iron-ajax
       	      id="addtocartreadajax"
       	      url="http://zencouch-zencodoo.rhcloud.com/grocery/14db510c2ae64d02e32a5145d000281a"
       	      handle-as="json"
       	      content-type="application/json"
              on-response="addtocartreadResponse"
              debounce-duration="300">
 </iron-ajax>
 <iron-ajax
        method="POST"
        id="addtocartwriteajax"
        url="http://zencouch-zencodoo.rhcloud.com/grocery/"
        body=""
        handle-as="json"
      content-type="application/json"></iron-ajax>

 <!--fetch the item of particular user and display in view card-->
 <iron-ajax
      	      id="viewcartajax"
      	      url="http://zencouch-zencodoo.rhcloud.com/grocery/14db510c2ae64d02e32a5145d000281a"
      	      handle-as="json"
      	      content-type="application/json"
             on-response="viewcartResponse"
             debounce-duration="300">
 </iron-ajax>
 <!--display the purchased item of particular user-->
 <iron-ajax
       	      id="purchaseajax"
       	      url="http://zencouch-zencodoo.rhcloud.com/grocery/14db510c2ae64d02e32a5145d000281a"
       	      handle-as="json"
       	      content-type="application/json"
              on-response="purchaseResponse"
              debounce-duration="300">
 </iron-ajax>
  <!--display the purchased item of  last three purchase particular user-->
   <iron-ajax
         	      id="lastthreepurchaseajax"
         	      url="http://zencouch-zencodoo.rhcloud.com/grocery/14db510c2ae64d02e32a5145d000281a"
         	      handle-as="json"
         	      content-type="application/json"
                on-response="lastthreepurchaseResponse"
                debounce-duration="300">
 </iron-ajax>
 <!--display the purchased item of  last three month particular user-->
  <iron-ajax
        	      id="purchasethreeajax"
        	      url="http://zencouch-zencodoo.rhcloud.com/grocery/14db510c2ae64d02e32a5145d000281a"
        	      handle-as="json"
        	      content-type="application/json"
               on-response="purchasethreeResponse"
               debounce-duration="300">
 </iron-ajax>
  <!--display the purchased item of  last six month particular user-->
   <iron-ajax
         	      id="purchasesixajax"
         	      url="http://zencouch-zencodoo.rhcloud.com/grocery/14db510c2ae64d02e32a5145d000281a"
         	      handle-as="json"
         	      content-type="application/json"
                on-response="purchasesixResponse"
                debounce-duration="300">
 </iron-ajax>
 <!--fetch the order no from the document -->
<iron-ajax
       	      id="ordernoajax"
       	      url="http://zencouch-zencodoo.rhcloud.com/grocery/f1eb50a17acce5d9880c463cf0000412"
       	      handle-as="json"
       	      content-type="application/json"
              on-response="ordernoResponse"
              debounce-duration="300">
 </iron-ajax>
 <iron-ajax
         method="POST"
         id="ordernowriteajax"
         url="http://zencouch-zencodoo.rhcloud.com/grocery/"
         body=""
         handle-as="json"
      content-type="application/json"></iron-ajax>
      <!---->
      <iron-ajax
	         	      id="buyreadajax"
	         	      url="http://zencouch-zencodoo.rhcloud.com/grocery/14db510c2ae64d02e32a5145d000281a"
	         	      handle-as="json"
	         	      content-type="application/json"
	                on-response="buyreadResponse"
	                debounce-duration="300">
 </iron-ajax>
 <iron-ajax
          method="POST"
          id="buywriteajax"
          url="http://zencouch-zencodoo.rhcloud.com/grocery/"
          body=""
          handle-as="json"
      content-type="application/json"></iron-ajax>
      <!--offer service-->
       <iron-ajax
	           	      id="offerserviceajax"
	           	      url="http://zencouch-zencodoo.rhcloud.com/grocery/14db510c2ae64d02e32a5145d000281a"
	           	      handle-as="json"
	           	      content-type="application/json"
	                  on-response="offerserviceResponse"
	                  debounce-duration="300">

 </iron-ajax>
   <iron-ajax
 	           	      id="offerallajax"
 	           	      url="{{url}}"
 	           	      handle-as="json"
 	           	      content-type="application/json"
 	                  on-response="offerallResponse"
 	                  debounce-duration="300">

 </iron-ajax>
  <iron-ajax
	           	      id="offerlistajax"
	           	      url="http://zencouch-zencodoo.rhcloud.com/grocery/f1eb50a17acce5d9880c463cf000078c"
	           	      handle-as="json"
	           	      content-type="application/json"
	                  on-response="offerlistResponse"
	                  debounce-duration="300">

 </iron-ajax>
 </template>

  <script>
  (function() {
      var itemval=[];
      var quantity;
      var total;
       var countarr=[];
       var offerlist=[];
       var offerarr=[];
    Polymer({
            is: "app-service",
            ready:function()
	        {


	        },
	        reqMenu:function()
	        {
	          var itemtype=JSON.stringify("Home");
			  this.url="http://zencouch-zencodoo.rhcloud.com/grocery/_design/menuviewdesign/_view/menuview?key="+itemtype;
	          this.$.menuajax.generateRequest();
	        },
	        //Drawer Menu response
	        menuResponse:function(e)
	        {
	        	this.menuitems=[];
	        	this.menuitems=e.detail.response;
	        	if(this.menuitems.rows.length>0)
		    	document.querySelector('app-list').itemcategory=this.menuitems.rows[0].value;
	        },
      		setCategory:function(selectedcategory)
      		{
      			var itemtype=JSON.stringify(selectedcategory);
      			this.url="http://zencouch-zencodoo.rhcloud.com/grocery/_design/menuviewdesign/_view/menuview?key="+itemtype;
	        	this.$.menuajax.generateRequest();
      		},
      		//Home category response
      		categoryResponse:function(e)
		    {
		    	  this.categoryarr=[];
				  this.categoryarr=e.detail.response;
				  document.querySelector('category-list').categoryarr=this.categoryarr.categoryarr;
				  document.querySelector('category-list').reload;
            },
            //Items under category response
            itemcategoryResponse:function(e)
		    {
				   this.itemcategoryarr=[]
			       this.itemcategoryarr=e.detail.response;
			       document.querySelector('itemcategory-list').itemarr=this.itemcategoryarr.rows[0].value;
			},
		    itemcategoryService:function(type)
			{
			this.$.offerserviceajax.generateRequest();
			      var groc=JSON.stringify(type);
			      //alert(groc);
				  this.name="http://zencouch-zencodoo.rhcloud.com/grocery/_design/categorydesign/_view/categoryview?key="+groc;
				 this.$.itemcategoryajax.generateRequest();

            },
            //Response given for all items under the category like rice,flours etc...
	        itemlistResponse:function(e)
	        { var flag="0";
	        		this.itemlist=[];
	        		this.itemarr=[];
	        		this.itemlist=e.detail.response;
	        		for(var i=0;i<this.itemlist.rows.length;i++)
	        		{
	        		flag="0";
	        		var itemval={"img":"","name": "","unit": "","price":"","discount":"","discountprice":"","discountprice1":""};
	        		for(var j=0;j<offerarr.length;j++)
	        		{
	        		if(this.itemlist.rows[i].value.name==offerarr[j].name)
	        		{
	        		var flag="1";
	        		itemval.img=offerarr[j].img;
							    		itemval.name=offerarr[j].name;
							    		itemval.unit=offerarr[j].unit;
							    		var flag=offerarr[j].flag;

							    		itemval.price=offerarr[j].price;
										itemval.discountprice=offerarr[j].discountprice;
							    		itemval.discountprice1=offerarr[j].discuntprice1;
							    		itemval.discount=offerarr[j].discount;
	        		this.itemarr.push(itemval);
	        		}
	        		}
	        		if(flag=="0")
	        		{
	        		itemval.img=this.itemlist.rows[i].value.img;
		    		itemval.name=this.itemlist.rows[i].value.name;
		    		itemval.unit="1 "+this.itemlist.rows[i].value.unit+"";
		    		var flag=this.itemlist.rows[i].value.flag;
		    		if(flag=="true")
		    		itemval.price=""+this.itemlist.rows[i].value.price+"/"+this.itemlist.rows[i].value.unit+"";
		    		else
		    		itemval.price="";
					itemval.discountprice=""+(parseInt(this.itemlist.rows[i].value.price)-(parseInt(this.itemlist.rows[i].value.price)*((parseInt(this.itemlist.rows[i].value.offer))/100)))+"/"+this.itemlist.rows[i].value.unit+"";
		    		itemval.discountprice1="Rs "+(parseInt(this.itemlist.rows[i].value.price)-(parseInt(this.itemlist.rows[i].value.price)*((parseInt(this.itemlist.rows[i].value.offer))/100)));
		    		itemval.discount=parseInt(this.itemlist.rows[i].value.price)-(parseInt(this.itemlist.rows[i].value.price)*((parseInt(this.itemlist.rows[i].value.offer))/100));
	        		this.itemarr.push(itemval);
	        		}
	  	    		}
	  	    		document.querySelector('item-list').itemarr=this.itemarr;
	        		document.querySelector('item-list').reload;
            },
            itemlistService:function(type,showtype)
	        {
            		this.type=type;
	        		var groc=JSON.stringify(this.type);
	        		if(showtype=="all")
	        		{
	       	        this.url="http://zencouch-zencodoo.rhcloud.com/grocery/_design/itemcategorydesign/_view/itemcategoryview?key="+groc;
	        		this.$.itemlistajax.generateRequest();
	        		}
	        		else if(showtype=="offer")
	        		{
	                this.url="http://zencouch-zencodoo.rhcloud.com/grocery/_design/itemcategoryofferdesign/_view/itemcategoryofferview?key="+groc;
	        		this.$.offeritemlistajax.generateRequest();
	        		}
			},
			//Response given for offer items under the category like rice,flours etc...
	        offeritemlistResponse:function(e)
	        {
	        		this.offerlist=[];
	        		this.itemarr=[];
	        		this.offerlist=e.detail.response;
	        		for(var i=0;i<this.offerlist.rows.length;i++)
	        		{
	        		var itemval={"img":"","name": "","unit": "","price":"","discount":"","discountprice":"","discuntprice1":""};
	        		itemval.img=this.offerlist.rows[i].value.img;
		    		itemval.name=this.offerlist.rows[i].value.name;
		    		itemval.unit="1 "+this.offerlist.rows[i].value.unit+"";
		    		itemval.price=""+this.offerlist.rows[i].value.price+"/"+this.offerlist.rows[i].value.unit+"";
					itemval.discountprice=""+(parseInt(this.offerlist.rows[i].value.price)-(parseInt(this.offerlist.rows[i].value.price)*((parseInt(this.offerlist.rows[i].value.offer))/100)))+"/"+this.offerlist.rows[i].value.unit+"";
		    		itemval.discountprice1="Rs "+(parseInt(this.offerlist.rows[i].value.price)-(parseInt(this.offerlist.rows[i].value.price)*((parseInt(this.offerlist.rows[i].value.offer))/100)));
		    		itemval.discount=parseInt(this.offerlist.rows[i].value.price)-(parseInt(this.offerlist.rows[i].value.price)*((parseInt(this.offerlist.rows[i].value.offer))/100));
	        		this.itemarr.push(itemval);
	  	    		}
	        		document.querySelector('offer-list').itemarr=this.itemarr;
	        		document.querySelector('offer-list').reload;
            },
            offeritemlistService:function(type,showtype)
	        {
                    this.type=type;
	        		var groc=JSON.stringify(this.type);
	        		if(showtype=="all")
	        		{
	                this.url="http://zencouch-zencodoo.rhcloud.com/grocery/_design/itemcategorydesign/_view/itemcategoryview?key="+groc;
	        		this.$.itemlistajax.generateRequest();
	        		}
	        		else if(showtype=="offer")
	        		{
	                this.url="http://zencouch-zencodoo.rhcloud.com/grocery/_design/itemcategoryofferdesign/_view/itemcategoryofferview?key="+groc;
	        		this.$.offeritemlistajax.generateRequest();
	        		}
      		},

      		//Response for brand list request
	        brandlistResponse:function(e)
	        {
	        		this.brandlist=[];
	        		this.itemarr=[];
	        		this.brandlist=e.detail.response;
	        		for(var i=0;i<this.brandlist.rows.length;i++)
	        		{
	        		var itemval={"img":"","name": "","unit": "","price":"","discount":"","discountprice":"","discuntprice1":""};
	        		itemval.img=this.brandlist.rows[i].value.img;
		   		itemval.name=this.brandlist.rows[i].value.name;
		    		itemval.unit="1 "+this.brandlist.rows[i].value.unit+"";
		    		var flag=this.brandlist.rows[i].value.flag;
		    		if(flag=="true")
		    		itemval.price=""+this.brandlist.rows[i].value.price+"/"+this.brandlist.rows[i].value.unit+"";
		    		else
		    		itemval.price="";
					itemval.discountprice=""+(parseInt(this.brandlist.rows[i].value.price)-(parseInt(this.brandlist.rows[i].value.price)*((parseInt(this.brandlist.rows[i].value.offer))/100)))+"/"+this.brandlist.rows[i].value.unit+"";
		    		itemval.discountprice1="Rs "+(parseInt(this.brandlist.rows[i].value.price)-(parseInt(this.brandlist.rows[i].value.price)*((parseInt(this.brandlist.rows[i].value.offer))/100)));
		    		itemval.discount=parseInt(this.brandlist.rows[i].value.price)-(parseInt(this.brandlist.rows[i].value.price)*((parseInt(this.brandlist.rows[i].value.offer))/100));
	        		this.itemarr.push(itemval);
	  	    		}
	  	            document.querySelector('brand-list').itemarr=this.itemarr;
	        		document.querySelector('brand-list').reload;
            },
            brandlistService:function(type)
	        {
                    this.type=type.trim();
	        		var groc=JSON.stringify(this.type);
	        		this.url="http://zencouch-zencodoo.rhcloud.com/grocery/_design/branddesign/_view/brandview?key="+groc;
	        		this.$.brandlistajax.generateRequest();
            },
            addtocartResponse:function(e)
            {

		   this.itemlist=[];
	       this.itemlist=e.detail.response;
           //alert('hii'+JSON.stringify(this.itemlist));
           //alert('hii'+JSON.stringify(this.itemlist.rows[n].value));
           for(var n=0;n<this.itemlist.rows.length;n++)
           {
            itemval={"type":"","category":"","img":"","name": "","unit": "","price":"","offer":"","flag":"","brand":"","status":"","quantity":"","total":"","cartstatus":""};
           itemval.type=this.itemlist.rows[n].value.type;
   		   itemval.category=this.itemlist.rows[n].value.category;
   		   itemval.img=this.itemlist.rows[n].value.img;
   		   itemval.name=this.itemlist.rows[n].value.name;
   		   itemval.unit=this.itemlist.rows[n].value.unit;
   		   itemval.price=this.itemlist.rows[n].value.price;
   		   itemval.offer=this.itemlist.rows[n].value.offer;
   		   itemval.flag=this.itemlist.rows[n].value.flag;
   		   itemval.brand=this.itemlist.rows[n].value.brand;
   		   itemval.status=this.itemlist.rows[n].value.status;
   		   //alert('dd'+quantity);
   		   itemval.quantity=quantity;
   		   itemval.total=total;
   		    itemval.cartstatus="Incart";
           //alert(JSON.stringify(itemval));
           this.$.addtocartreadajax.generateRequest();
		  }

            },
            addtocartservice:function(name,quant,tot)
            {
            quantity=quant;
            total=tot;
			var items=JSON.stringify(name);
	       this.url="http://zencouch-zencodoo.rhcloud.com/grocery/_design/addtocartdesign/_view/addtocartview?key="+items;
           this.$.addtocartajax.generateRequest();

            },
            addtocartreadResponse:function(e)
            {
            var flag="0";
            var user=sessionStorage.getItem("info");
		    //alert('hello '+user);
            this.cart=[];
            this.cart=e.detail.response;
            this.addtocart=e.detail.response.addtocart;
             this.id=e.detail.response._id;
		    this.header=e.detail.response._rev;
            //alert(JSON.stringify(this.addtocart));
            for(var i=0;i<this.addtocart.length;i++)
            {
            //alert("vvvv"+JSON.stringify(this.addtocart[i].name)+''+user);
            if(this.addtocart[i].name==user)
            {

//alert('hi');
            flag="1";
          this.addtocart[i].cartitem.push(itemval);
            //alert(JSON.stringify(this.addtocart));
            var obj={"_id": "","_rev":"","addtocart":""};
            obj._id=this.id;
            obj._rev=this.header;
            obj.addtocart=this.addtocart;
            this.$.addtocartwriteajax.body=JSON.stringify(obj);
            this.$.addtocartwriteajax.generateRequest();
            }
            }
            if(flag=="0")
            {
           var newcart={"name":"","cartitem":"","purchased":""};
           newcart.name=user;
           newcart.cartitem=[];
           newcart.cartitem.push(itemval);
           newcart.purchased=[];
           this.addtocart.push(newcart);
            var obj={"_id": "","_rev":"","addtocart":""};
		               obj._id=this.id;
		               obj._rev=this.header;
		               obj.addtocart=this.addtocart;
		               this.$.addtocartwriteajax.body=JSON.stringify(obj);
            this.$.addtocartwriteajax.generateRequest();
            }

            },
            //view cart of the user
            viewcart:function()
            {
             alert('app cart');
          this.$.viewcartajax.generateRequest();
            },

viewcartResponse:function(e)
{
var flag="0";
this.viewcartitem=[];
this.itemview=[];
this.itemview=e.detail.response.addtocart;
var uname=JSON.stringify(sessionStorage.getItem("info"));
//alert(JSON.stringify(this.itemview));
 for(var i=0;i<this.itemview.length;i++)
            {
            if(JSON.stringify(this.itemview[i].name)==uname)
            {
            if(this.itemview[i].cartitem.length>0)
            {
            flag="1";
            viewcartitem=this.itemview[i].cartitem;
            //alert('cart'+JSON.stringify(this.itemview[i].cartitem));
            document.querySelector('my-app').setPage("view card","page1","view card");
            document.querySelector('viewcart-list').itemarr=this.itemview[i].cartitem;
            document.querySelector('viewcart-list').reload;
            }

            }
            }
            if(flag=="0")
            {
             document.querySelector('my-app').setPage("No Item","page1","");
            }

},
//display the purchased item of particular user
purchaseService:function()
{
//alert('purchase service');
this.$.purchaseajax.generateRequest();
},
purchaseResponse:function(e)
{
this.viewpurchase=[];
this.purchaseitem=[];
this.purchaseitem=e.detail.response.addtocart;
var flag="0";
//alert(JSON.stringify(e.detail.response));
var uname=JSON.stringify(sessionStorage.getItem("info"));
//alert(uname);
 for(var i=0;i<this.purchaseitem.length;i++)
            {
            if(JSON.stringify(this.purchaseitem[i].name)==uname)
            {
 if(this.purchaseitem[i].purchased.length>0)
 {
 flag="1";
            for(var j=0;j<this.purchaseitem[i].purchased.length;j++)
            {

            this.viewpurchase.push(this.purchaseitem[i].purchased[j]);
            }
            }
            }
            }

            if(flag=="1")
            {
            //alert(JSON.stringify(this.viewpurchase));
            document.querySelector('purchase-list').itemarr=this.viewpurchase;
            }
            else
            {
             document.querySelector('my-app').setPage("No Item","page1","");
            }
},
//Last three purchase
lastthreepurchase:function()
{
alert('purchase service');
this.$.lastthreepurchaseajax.generateRequest();
},
lastthreepurchaseResponse:function(e)
{
var currentdate;
var orderdate;
var datediff;
this.threepurchase=[];
this.purchaseitem=[];
 var array_last_three;
this.purchaseitem=e.detail.response.addtocart;
var flag="0";
//alert(JSON.stringify(e.detail.response));
var uname=JSON.stringify(sessionStorage.getItem("info"));
//alert(uname);
 for(var i=0;i<this.purchaseitem.length;i++)
            {
            if(JSON.stringify(this.purchaseitem[i].name)==uname)
            {
              flag="1";
             array_last_three= this.purchaseitem[i].purchased.slice(-3);
//alert(JSON.stringify(array_last_three));

            }
            }
            if(flag=="1")
			            {
			            //alert(JSON.stringify(this.viewpurchase));
			            document.querySelector('purchase-list').itemarr=array_last_three;
            }
            else
            {
             document.querySelector('my-app').setPage("No Item","page1","");
            }
},
//purchase item of last three month
purchasethreeService:function()
{
alert('purchase service');
this.$.purchasethreeajax.generateRequest();
},
purchasethreeResponse:function(e)
{
var currentdate;
var orderdate;
var datediff;
this.threepurchase=[];
this.purchaseitem=[];
this.purchaseitem=e.detail.response.addtocart;
var flag="0";
//alert(JSON.stringify(e.detail.response));
var uname=JSON.stringify(sessionStorage.getItem("info"));
//alert(uname);
 for(var i=0;i<this.purchaseitem.length;i++)
            {
            if(JSON.stringify(this.purchaseitem[i].name)==uname)
            {

            for(var j=0;j<this.purchaseitem[i].purchased.length;j++)
            {

            //alert(this.purchaseitem[i].purchased[j].date);
            orderdate=new Date(this.purchaseitem[i].purchased[j].date);
            currentdate=new Date();
            datediff=currentdate.getMonth()-orderdate.getMonth();
            //alert(datediff);
            if(datediff<=3)
            {
            flag="1";
            this.threepurchase.push(this.purchaseitem[i].purchased[j]);
            }
            }
            }
            }
            if(flag=="1")
			            {
			            //alert(JSON.stringify(this.viewpurchase));
			            document.querySelector('purchase-list').itemarr=this.threepurchase;
            }
            else
            {
             document.querySelector('my-app').setPage("No Item","page1","");
            }
},
// Last Six Month Purchase item of particular user
purchasesixService:function()
{
//alert('purchase service');
this.$.purchasesixajax.generateRequest();
},
purchasesixResponse:function(e)
{
var currentdate;
var orderdate;
var datediff;
this.sixpurchase=[];
this.purchaseitem=[];
this.purchaseitem=e.detail.response.addtocart;
var flag="0";
//alert(JSON.stringify(e.detail.response));
var uname=JSON.stringify(sessionStorage.getItem("info"));
//alert(uname);
 for(var i=0;i<this.purchaseitem.length;i++)
            {
            if(JSON.stringify(this.purchaseitem[i].name)==uname)
            {

            for(var j=0;j<this.purchaseitem[i].purchased.length;j++)
            {

            //alert(this.purchaseitem[i].purchased[j].date);
            orderdate=new Date(this.purchaseitem[i].purchased[j].date);
            currentdate=new Date();
            datediff=currentdate.getMonth()-orderdate.getMonth();
            //alert(datediff);
            if(datediff<=6)
            {
            flag="1";
            this.sixpurchase.push(this.purchaseitem[i].purchased[j]);
            }
            }
            }
            }
            if(flag=="1")
			            {
			            //alert(JSON.stringify(this.viewpurchase));
			            document.querySelector('purchase-list').itemarr=this.sixpurchase;
            }
            else
            {
             document.querySelector('my-app').setPage("No Item","page1","");
            }
},
//buy service
buyservice:function()
{
this.$.ordernoajax.generateRequest();
},
//generate the order number for the item
ordernoResponse:function(e)
{
     this.id=e.detail.response._id;
     this.header=e.detail.response._rev;
     this.orderno=parseInt(e.detail.response.orderno)+1;
     sessionStorage.setItem("orderid",this.orderno);
  alert('order number:'+this.orderno);
   var obj={"_id": "","_rev":"","orderno":""};
              obj._id=this.id;
              obj._rev=this.header;
              obj.orderno=this.orderno;
              this.$.ordernowriteajax.body=JSON.stringify(obj);
              this.$.ordernowriteajax.generateRequest();
                  this.$.buyreadajax.generateRequest();

},
buyreadResponse:function(e)
{
this.id=e.detail.response._id;
this.header=e.detail.response._rev;
this.ordernum;
this.date;
this.buylist=[];
this.buyitem=[];
this.buylist=e.detail.response.addtocart;
//alert(JSON.stringify(e.detail.response));
var uname=JSON.stringify(sessionStorage.getItem("info"));
 for(var i=0;i<this.buylist.length;i++)
            {
            if(JSON.stringify(this.buylist[i].name)==uname)
            {
            for(var j=0;j<this.buylist[i].cartitem.length;j++)
            {
            this.buyitem.push(this.buylist[i].cartitem[j]);
            }
            //alert(JSON.stringify(this.buyitem));
            this.ordernum=sessionStorage.getItem("orderid");
            this.date=new Date();
             var list={"orderno":"","date":"","purchaseitem":""};
             list.orderno=this.ordernum;
             list.date=this.date;
             list.purchaseitem=this.buyitem;
             this.buylist[i].purchased.push(list);
             this.buylist[i].cartitem=[];
            }
            }
   var obj={"_id": "","_rev":"","addtocart":""};
            obj._id=this.id;
            obj._rev=this.header;
            obj.addtocart=this.buylist;
            this.$.buywriteajax.body=JSON.stringify(obj);
            this.$.buywriteajax.generateRequest();
            },
            //offer service of particular user

            offerService:function()
            {
            this.$.offerserviceajax.generateRequest();
            //alert('offer');
            },
            offerserviceResponse:function(e)
            {
            var product=[];

            var allproducts=[];
            var count;
            this.offeritem=[];
			this.offeritem=e.detail.response.addtocart;
			var flag="0";
			var uname=JSON.stringify(sessionStorage.getItem("info"));
			//alert(uname);
			 for(var i=0;i<this.offeritem.length;i++)
			            {
			            //alert(JSON.stringify(this.offeritem[i].name));
			            if(JSON.stringify(this.offeritem[i].name)==uname)
			            {
			            for(var j=0;j<this.offeritem[i].purchased.length;j++)
			          {

			          for(var k=0;k<this.offeritem[i].purchased[j].purchaseitem.length;k++)
			          {

			         allproducts.push(this.offeritem[i].purchased[j].purchaseitem[k].name);
			          }

			          }
			          allproducts.sort();
			          var current = null;
					  var cnt = 0;
					  for (var i = 0; i < allproducts.length; i++)
					  {
					      if (allproducts[i] != current) {
					          if (cnt > 0) {
					          count={"name":"","times":""};
					          count.name=current;
					          count.times=cnt;
					          countarr.push(count);
					          product.push(current);
					              //alert(current + '  --> ' + cnt + ' times');
					          }
					          current = allproducts[i];
					          cnt = 1;
					      } else {
					          cnt++;
					      }
					  }
					  if (cnt > 0)
					  {
					  count={"name":"","times":""};
					  					          count.name=current;
					  					          count.times=cnt;
					          countarr.push(count);
					          product.push(current);
					      //alert(current + ' --> ' + cnt + ' times');
                         }
			          //alert(JSON.stringify(allproducts));
			          //alert(JSON.stringify(countarr));
			           //alert(JSON.stringify(product));
			          }
			          }
			          var val=[];
			         val= JSON.stringify(product)
this.url="http://zencouch-zencodoo.rhcloud.com/grocery/_design/offerdesign/_view/offerview?keys="+val;
this.$.offerallajax.generateRequest();
this.$.offerlistajax.generateRequest();
            },
         offerlistResponse:function(e)
         {

offerlist=e.detail.response.offerarr;
//alert(JSON.stringify(offerlist));
         },
            offerallResponse:function(e)
            {
             offerarr=[];
            var setoffer=[];
            //alert(JSON.stringify(e.detail.response.rows));
            setoffer=e.detail.response.rows;
            for(var i=0;i<setoffer.length;i++)
            {
            //alert(JSON.stringify(setoffer[i].value.name));
            for(var j=0;j<countarr.length;j++)
            {
            if(setoffer[i].value.name==countarr[j].name)
            {
            for(var k=0;k<offerlist.length;k++)
            {
            if((parseInt(offerlist[k].count)<=parseInt(countarr[j].times)) &&(parseInt(offerlist[k+1].count)>parseInt(countarr[j].times)))
            {
           //alert(JSON.stringify(offerlist[k].offer)+' '+JSON.stringify(countarr[j].name));
            setoffer[i].value.offer=offerlist[k].offer;
            }
            }
            }

            }
            }
            //alert(JSON.stringify(setoffer));
            for(var i=0;i<setoffer.length;i++)
				        		{
				        		var itemval={"img":"","name": "","unit": "","price":"","discount":"","discountprice":"","discuntprice1":""};
				        		itemval.img=setoffer[i].value.img;
					    		itemval.name=setoffer[i].value.name;
					    		itemval.unit="1 "+setoffer[i].value.unit+"";
					    		itemval.price=""+setoffer[i].value.price+"/"+setoffer[i].value.unit+"";
								itemval.discountprice=""+(parseInt(setoffer[i].value.price)-(parseInt(setoffer[i].value.price)*((parseInt(setoffer[i].value.offer))/100)))+"/"+setoffer[i].value.unit+"";
					    		itemval.discountprice1="Rs "+(parseInt(setoffer[i].value.price)-(parseInt(setoffer[i].value.price)*((parseInt(setoffer[i].value.offer))/100)));
					    		itemval.discount=parseInt(setoffer[i].value.price)-(parseInt(setoffer[i].value.price)*((parseInt(setoffer[i].value.offer))/100));
				        		offerarr.push(itemval);
				  	    		}
//alert(JSON.stringify(this.itemarr));
				        		document.querySelector('myoffer-list').itemarr=offerarr;
	        		         document.querySelector('myoffer-list').reload;
            }





    });
     })();
  </script>
</dom-module>